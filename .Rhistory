library(MultiObjMatch)
?multiObjMatch
?getUnmatched
library(devtools)
library(MultiObjMatch)
install_github("ShichaoHan/MultiObjMatch")
library(MultiObjMatch)
?multiObjMatch
library(MultiObjMatch)
?multiObjMatch
devtools::document()
library(MultiObjMatch)
?multiObjMatch
setwd("~/Desktop/SHICHAO/College/STATSC245B/query")
knitr::opts_chunk$set(echo = TRUE)
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
dat = read.csv("sp_info.csv")
newdat = read.csv("facts_df.csv")
x = vector()
for (i in 1:dim(dat)[1])
{
if (sum(dat$spid[i]==newdat$spid)==1){
x = c(x, i)
}
}
dat = dat[x, ]
status = rep(0, dim(dat)[1])
status[dat$spdied=="1 YES"] = 1
time = (dat$year_left-dat$year_enter)
newdat$status = status
newdat$time = time
km_fit = survfit(Surv(time, status) ~ 1, data = newdat)
autoplot(km_fit)
km_fit = survfit(Surv(time, status) ~ Treat, data = newdat)
autoplot(km_fit)
cox <- coxph(Surv(time, status) ~  ., data = newdat)
cox_fit <- survfit(cox)
autoplot(cox_fit)
summary(cox_fit)
cox_fit
summary(cox_fit)
cox
cox$coefficients
head(newdat)
cox$coefficients
cox$wald.test
confint(coxph)
confint(cox)
res.cox.sum <- summary(cox)$coefficients
res.cox.sum
res.cox.sum[,5]
2.607573e-01
cox <- coxph(Surv(time, status) ~  Treat., data = newdat)
cox <- coxph(Surv(time, status) ~  treat., data = newdat)
head(newdat)
cox <- coxph(Surv(time, status) ~  Treat, data = newdat)
res.cox.sum <- summary(cox)$coefficients
res.cox.sum[,5]
head(newdat)
colnames(newdat)
colnames(newdat)[c(3:23)]
covs = colnames(newdat)[c(3:23)]
covs = colnames(newdat)[c(3:25)]
covs
covs = colnames(newdat)[c(3:25)]
covs = covs[covs!= "dnumchild"]
covs = colnames(newdat)[c(3:25)]
covs = covs[covs!= "dnumchild"]
cox <- coxph(Surv(time, status) ~  Treat, data = newdat[,covs])
res.cox.sum <- summary(cox)$coefficients
res.cox.sum[,5]
cox <- coxph(Surv(time, status) ~ ., data = newdat[,covs])
res.cox.sum <- summary(cox)$coefficients
res.cox.sum[,5]
pvals_cox = res.cox.sum[,5]
pvals_cox[pvals_cox <= 0.05]
res.cox.sum
data.frame(res.cox.sum)
write.csv(data.frame(res.cox.sum), "cox_model_result.csv")
install.packages("survtmle")
ftype <- newdat$status
ftime <- newdat$time
trt <- newdat$Treat
covs
covs[1:19]
adjCovs <- covs[1:19]
adjustVars <- newdat[, adjCovs]
library(SuperLearner)
?survtmle
library(survtmle)
?survtmle
ftype <- newdat$status
ftime <- newdat$time
trt <- newdat$Treat
adjCovs <- covs[1:19]
adjustVars <- newdat[, adjCovs]
fit1 <- survtmle(ftime = ftime, ftype = ftype, trt = trt, adjustVars=adjustVars, method="mean")
ftime
ftime <- newdat$time + 1
fit1 <- survtmle(ftime = ftime, ftype = ftype, trt = trt, adjustVars=adjustVars, method="mean")
fit1
ftype <- newdat$status
ftime <- newdat$time + 1
trt <- newdat$Treat
adjCovs <- covs[1:19]
adjustVars <- newdat[, adjCovs]
fit1 <- survtmle(ftime = ftime, ftype = ftype, trt = trt, adjustVars=adjustVars, method="hazard")
fit1
fit1 <- survtmle(ftime = ftime, ftype = ftype, trt = trt, adjustVars=adjustVars, method="hazard",t0 = 6)
fit1
tpfit <- timepoints(fit1, times = seq_len(6))
tpfit <- timepoints(fit1, times = seq_len(6))
```
tpfit
plot(tpfit)
tpfit
library(SuperLearner)
fit3 <- survtmle(ftime = ftime, ftype = ftype, trt = trt, adjustVars=adjustVars,SL.trt = c("SL.glm","SL.mean","SL.step"),
SL.ftime = c("SL.glm","SL.mean","SL.step"),
SL.ctime = c("SL.glm","SL.mean","SL.step"),
method="mean",t0 = 6)
fit3 <- survtmle(ftime = ftime, ftype = ftype, trt = trt, adjustVars=adjustVars,SL.trt = c("SL.glm","SL.mean","SL.step"),
SL.ftime = c("SL.glm","SL.mean","SL.step"),
SL.ctime = c("SL.glm","SL.mean","SL.step"),
method="hazard",t0 = 6)
ftype <- newdat$status
ftime <- newdat$time + 1
trt <- newdat$Treat
adjCovs <- covs[1:19]
adjustVars <- newdat[, adjCovs]
fit1 <- survtmle(ftime = ftime, ftype = ftype, trt = trt, adjustVars=adjustVars, method="hazard",t0 = 6)
fit1
tpfit <- timepoints(fit1, times = seq_len(6))
tpfit
plot(tpfit)
tpfit
cox_result <- read.csv( "cox_model_result.csv")
cox_result
cox_result[cox_result$Pr...z.. <= 0.05,]
cox_result <- read.csv( "cox_model_result.csv")
cox_result[cox_result$Pr...z.. <= 0.05,]
cox_result <- read.csv( "cox_model_result.csv")
cox_result[cox_result$Pr...z.. <= 0.05,]
nrow(cox_result)
cox_result[cox_result$Pr...z.. <= 0.05,]
cox_result
cox_result[cox_result$Pr...z.. <=0.05]
cox_result[cox_result$Pr...z.. <=0.05,]
dat_cox <- cox_result[cox_result$Pr...z.. <=0.05,]
dat_cox <- dat_cox[!is.na(dat_cox$z),]
dat_cox
options(digits = 5)
cox_result <- read.csv( "cox_model_result.csv")
dat_cox <- cox_result[cox_result$Pr...z.. <=0.05,]
dat_cox <- dat_cox[!is.na(dat_cox$z),]
dat_cox
dat_cox[,c(1,2,5)]
print(dat_cox[,c(1,2,5)])
print(dat_cox[,c(1,2,5)])
write.csv(dat_cox[,c(1,2,5)], "cox_select.csv")
write.csv(dat_cox[,c(1,2,5)], "cox_select.csv",digits = 5)
?write.csv
options(digits = 5)
cox_result <- read.csv( "cox_model_result.csv")
dat_cox <- cox_result[cox_result$Pr...z.. <=0.05,]
dat_cox <- dat_cox[!is.na(dat_cox$z),]
write.csv(dat_cox, "cox_select.csv")
znorm(0.95)
pnorm(0.95)
qnorm(0.95)
ftype <- newdat$status
ftime <- newdat$time + 1
trt <- newdat$Treat
adjCovs <- covs[1:19]
adjustVars <- newdat[, adjCovs]
fit1 <- survtmle(ftime = ftime, ftype = ftype, trt = trt, adjustVars=adjustVars, method="hazard",t0 = 6)
fit1
tpfit <- timepoints(fit1, times = seq_len(6))
tpfit
plot(tpfit)
tpfit
colnames(newdat)
result1 <- tmle(Y=time, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
library(tmle)
result1 <- tmle(Y=time, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result1)
newdat$time
summary(result1)
result1 <- tmle(Y=time>=5, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result1)
result1 <- tmle(Y=time>=6, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result1)
result2 <- tmle(Y=time>=5, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result2)
result1 <- tmle(Y=time>=6, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result1)
result3 <- tmle(Y=time, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result3)
covs
covs = colnames(newdat)[3:22]
covs = covs[covs != "dnumchild"]
covs = covs[covs != "time"]
covs = covs[covs != "status"]
covs = covs[covs != "Treat"]
covs
result2 <- tmle(Y=time>=5, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result2)
result3 <- tmle(Y=time, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result3)
result1 <- tmle(Y=time>=6, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result1)
covs
covs = covs[covs != "dracehisp"]
result2 <- tmle(Y=time>=5, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result2)
covs
covs = covs[covs != "X2intvrage"]
result3 <- tmle(Y=time, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result3)
covs = covs[covs != "X2intvrage"]
result3 <- tmle(Y=time, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result3)
cosv
covs
covs = covs[covs != "X2intvrage"]
covs = covs[covs != "disescn1"]
covs = covs[covs != "disescn2"]
covs = covs[covs != "disescn3"]
result3 <- tmle(Y=time, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result3)
result2 <- tmle(Y=time>=5, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result2)
library(SuperLearner)
result2 <- tmle(Y=time>=5, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result2)
?tmle
result3 <- tmle(Y=time, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result3)
covs = colnames(newdat)[3:22]
covs = covs[covs != "dnumchild"]
covs = covs[covs != "time"]
covs = covs[covs != "status"]
covs = covs[covs != "Treat"]
result3 <- tmle(Y=time, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result3)
cox_result <- read.csv( "cox_model_result.csv")
dat_cox <- cox_result[cox_result$Pr...z.. <=0.05,]
dat_cox <- dat_cox[!is.na(dat_cox$z),]
dat_cox
result2 <- tmle(Y=time>=5, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result2)
result2 <- tmle(Y=time>=6, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result2)
result2 <- tmle(Y=time>=4, A=newdat$Treat,W=newdat[, covs], Delta=newdat$status)
summary(result2)
0.005 - 1.96* 0.005
qnorm(-0.005)
qnorm(0.005/0.004)
pnorm(0.005/0.004, 0, 0,004)
pnorm(0.005/0.004, 0, 0.004)
pnorm(0.005/0.004, 0, 0.004)
0.009 - 0.005*1.95
0.009 + 0.005*1.95
0.008 - 0.005*1.95
0.008 + 0.005*1.95
pnorm(0.008/0.005)
2*(1 - pnorm(0.008/0.005))
2*(1 - pnorm(0.009/0.005))
-0.164 - 1.96*0.005
-0.164 + 1.96*0.005
-0.021 - 1.96*0.010
-0.021 + 1.96*0.010
2*pnorm(-0.164/0.005)
2*pnorm(-0.021/0.01)
document()
library(devtools)
document()
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
install_github("ShichaoHan/MultiObjMatch", ref="main")
library(MultiObjMatch)
library(MatchIt)
data("lalonde")
psCols <- c("age", "educ", "married", "nodegree")
treatVal <- "treat"
responseVal <- "re78"
pairDistVal1 <- c("age","married","educ", "nodegree")
exactVal <- c("educ")
myBalVal <- c("race")
r1s <- c(0.01,0.02,0.03,0.1,0.5,1,1.5,2,2.5,4,5,6,7,8,9,10)
r2s <- c(1)
matchResult <- multiObjMatch(lalonde, treatVal, responseVal, pairDistVal,
exactVal, myBalVal, rho1=r1s, rho2=r2s, propensityCols = psCols,
pScores = NULL, idCol = NULL, maxUnMatched = 0.1, caliperOption=0.25,
toleranceOption=1e-1, maxIter=3, rho.max.f = 10)
psCols <- c("age", "educ", "married", "nodegree")
treatVal <- "treat"
responseVal <- "re78"
pairDistVal <- c("age","married","educ", "nodegree")
exactVal <- c("educ")
myBalVal <- c("race")
r1s <- c(0.01,0.02,0.03,0.1,0.5,1,1.5,2,2.5,4,5,6,7,8,9,10)
r2s <- c(1)
matchResult <- multiObjMatch(lalonde, treatVal, responseVal, pairDistVal,
exactVal, myBalVal, rho1=r1s, rho2=r2s, propensityCols = psCols,
pScores = NULL, idCol = NULL, maxUnMatched = 0.1, caliperOption=0.25,
toleranceOption=1e-1, maxIter=3, rho.max.f = 10)
lalonde
library(Matching)
data("lalonde")
lalonde
lalonde
psCols <- c("age", "educ", "married", "nodegree")
treatVal <- "treat"
responseVal <- "re78"
pairDistVal <- c("age","married","educ", "nodegree")
exactVal <- c("educ")
myBalVal <- c("race")
lalonde
r1s <- c(0.01,0.02,0.03,0.1,0.5,1,1.5,2,2.5,4,5,6,7,8,9,10)
r2s <- c(1)
matchResult <- multiObjMatch(lalonde, treatVal, responseVal, pairDistVal,
exactVal, myBalVal, rho1=r1s, rho2=r2s, propensityCols = psCols,
pScores = NULL, idCol = NULL, maxUnMatched = 0.1, caliperOption=0.25,
toleranceOption=1e-1, maxIter=3, rho.max.f = 10)
lalonde
library(MatchIt)
data("lalonde")
lalonde
psCols <- c("age", "educ", "married", "nodegree")
treatVal <- "treat"
responseVal <- "re78"
pairDistVal <- c("age","married","educ", "nodegree")
exactVal <- c("educ")
myBalVal <- c("race")
lalonde
r1s <- c(0.01,0.02,0.03,0.1,0.5,1,1.5,2,2.5,4,5,6,7,8,9,10)
r2s <- c(1)
matchResult <- multiObjMatch(lalonde, treatVal, responseVal, pairDistVal,
exactVal, myBalVal, rho1=r1s, rho2=r2s, propensityCols = psCols,
pScores = NULL, idCol = NULL, maxUnMatched = 0.1, caliperOption=0.25,
toleranceOption=1e-1, maxIter=3, rho.max.f = 10)
library(dplyr)
library(optmatch)
library(rcbalance)
library(matchMulti)
library(RCurl)
library(MultiObjMatch)
library(cobalt)
data("lalonde")
lalonde
library(MultiObjMatch)
library(dplyr)
library(optmatch)
library(rcbalance)
library(matchMulti)
library(RCurl)
library(MultiObjMatch)
library(cobalt)
data("lalonde")
lalonde
library(cobalt)
data("lalonde")
lalonde
data("lalonde", package = "cobalt")
lalonde
r1s <- c(0.01,0.02,0.03,0.1,0.5,1,1.5,2,2.5,4,5,6,7,8,9,10)
r2s <- c(1)
matchResult <- multiObjMatch(lalonde, treatVal, responseVal, pairDistVal,
exactVal, myBalVal, rho1=r1s, rho2=r2s, propensityCols = psCols,
pScores = NULL, idCol = NULL, maxUnMatched = 0.1, caliperOption=0.25,
toleranceOption=1e-1, maxIter=3, rho.max.f = 10)
matchResult$rhoList
generate_balance_table(matchingResult)
generate_balance_table(matchResult)
generate_balance_table(matchResult)
compare_matching(mathResult, covList=c("age", "educ", "race", "married", "nodegree"))
compare_matching(mathResult, covList=c("age", "educ", "race", "married", "nodegree"))
compare_matching(matchResult, covList=c("age", "educ", "race", "married", "nodegree"))
generate_tv_graph(matchResult)
generate_pairdistance_graph(matchResult)
generate_pairdistance_balance_graph(matchResult)
psCols <- c("age", "educ", "married", "nodegree")
treatVal <- "treat"
responseVal <- "re78"
pairDistVal <- c("age","married","educ", "nodegree")
exactVal <- c("educ")
myBalVal <- c("race")
r1s <- c(0.01,0.02,0.03,0.1,0.5,1,1.5,2,2.5,4,5,6,7,8,9,10)
r2s <- c(1)
matchResult <- multiObjMatch(lalonde, treatVal, responseVal, pairDistVal,
exactVal, myBalVal, rho1=r1s, rho2=r2s, propensityCols = psCols,
pScores = NULL, idCol = NULL, maxUnMatched = 0.1, caliperOption=0.25,
toleranceOption=1e-1, maxIter=0, rho.max.f = 10)
compare_matching(matchResult, covList=c("age", "educ", "race", "married", "nodegree"))
generate_tv_graph(matchResult)
generate_pairdistance_graph(matchResult)
generate_pairdistance_balance_graph(matchResult)
psCols <- c("age", "educ", "married", "nodegree")
## Specify the name of treatment variable
treatVal1 <- "treat"
## Specify the name of response variable
responseVal1 <- "re78"
## Specify the list of variable names used for calculating the pairwise distance
pairDistVal1 <- c("age","married","educ", "nodegree")
## Specify the column for exact matching
exactVal1 <- c("educ")
## Specify the column for measuring balance in algorithm
myBalVal1 <- c("race")
head(lalonde)
## Specify the values to try for rho1
r1s <- c(0.01, 0.02, 0.03, 0.04, 0.1, 0.3, 0.5, 0.7, 0.9)
## Specify the values to try for rho2
r2s <- c(1)
tempResult13 <- multiObjMatch(lalonde, treatVal1 , responseVal1 , pairDistVal1 , exactVal1, myBalVal1, rho1=r1s, rho2=r2s, propensityCols = psCols, pScores = NULL, idCol = NULL, maxUnMatched = 0.1, caliperOption=0.25, toleranceOption=1e-1, maxIter=3, rho.max.f = 10)
compare_matching(tempResult13, covList=c("age", "educ", "race", "married", "nodegree"))
generate_tv_graph(tempResult13)
library(devtools)
install_github("ShichaoHan/MultiObjMatch", ref="main")
library(MultiObjMatch)
library(MultiObjMatch)
library(dplyr)
library(optmatch)
library(rcbalance)
library(matchMulti)
library(RCurl)
library(MultiObjMatch)
library(cobalt)
data("lalonde", package="cobalt")
lalonde
psCols <- c("age", "educ", "married", "nodegree")
## Specify the name of treatment variable
treatVal1 <- "treat"
## Specify the name of response variable
responseVal1 <- "re78"
## Specify the list of variable names used for calculating the pairwise distance
pairDistVal1 <- c("age","married","educ", "nodegree")
## Specify the column for exact matching
exactVal1 <- c("educ")
## Specify the column for measuring balance in algorithm
myBalVal1 <- c("race")
head(lalonde)
## Specify the values to try for rho1
r1s <- c(0.01, 0.02, 0.03, 0.04, 0.1, 0.3, 0.5, 0.7, 0.9)
## Specify the values to try for rho2
r2s <- c(1)
tempResult13 <- multiObjMatch(lalonde, treatVal1 , responseVal1 , pairDistVal1 , exactVal1, myBalVal1, rho1=r1s, rho2=r2s, propensityCols = psCols, pScores = NULL, idCol = NULL, maxUnMatched = 0.1, caliperOption=0.25, toleranceOption=1e-1, maxIter=3, rho.max.f = 10)
compare_matching(tempResult13, covList=c("age", "educ", "race", "married", "nodegree"))
generate_tv_graph(tempResult13)
-log(0.5)
exp(0.125*0.7)
exp((-3)*0.7)
log(exp)
log
asd
askmd;fl'o'
rw;"q"
log(e)
exp(1)
log(0.125)
log(0.125)/(-2)
exp(-3*1.039721)
library(devtools)
install_github("ShichaoHan/MultiObjMatch", ref="main")
library(MultiObjMatch)
library(dplyr)
library(optmatch)
library(rcbalance)
library(matchMulti)
library(RCurl)
library(MultiObjMatch)
library(cobalt)
data("lalonde", package="cobalt")
psCols <- c("age", "educ", "married", "nodegree")
treatVal <- "treat"
responseVal <- "re78"
pairDistVal <- c("age","married","educ", "nodegree")
exactVal <- c("educ")
myBalVal <- c("race")
r1s <- c(0.01,0.02,0.03,0.1,0.5,1,1.5,2,2.5,4,5,6,7,8,9,10)
r2s <- c(1)
matchResult <- multiObjMatch(lalonde, treatVal, responseVal, pairDistVal,
exactVal, myBalVal, rho1=r1s, rho2=r2s, propensityCols = psCols,
pScores = NULL, idCol = NULL, maxUnMatched = 0.1, caliperOption=0.25,
toleranceOption=1e-1, maxIter=0, rho.max.f = 10)
compare_matching(matchResult, covList=c("age", "educ", "race", "married", "nodegree"))
psCols <- c("age", "educ", "married", "nodegree")
## Specify the name of treatment variable
treatVal1 <- "treat"
## Specify the name of response variable
responseVal1 <- "re78"
## Specify the list of variable names used for calculating the pairwise distance
pairDistVal1 <- c("age","married","educ", "nodegree")
## Specify the column for exact matching
exactVal1 <- c("educ")
## Specify the column for measuring balance in algorithm
myBalVal1 <- c("race")
head(lalonde)
## Specify the values to try for rho1
r1s <- c(0.01, 0.02, 0.03, 0.04, 0.1, 0.3, 0.5, 0.7, 0.9)
## Specify the values to try for rho2
r2s <- c(1)
tempResult13 <- multiObjMatch(lalonde, treatVal1 , responseVal1 , pairDistVal1 , exactVal1, myBalVal1, rho1=r1s, rho2=r2s, propensityCols = psCols, pScores = NULL, idCol = NULL, maxUnMatched = 0.1, caliperOption=0.25, toleranceOption=1e-1, maxIter=3, rho.max.f = 10)
compare_matching(tempResult13, covList=c("age", "educ", "race", "married", "nodegree"))
generate_tv_graph(tempResult13)
exp(-log(2))
exp(-2log(2))
exp(-2*log(2))
